---
export const prerender = true;
import Base from "../layouts/Base.astro";
---

<Base title="Contact — Ligerian Labs | IA à Angers" description="Contactez Ligerian Labs pour discuter de votre projet IA. Basés à Angers, nous accompagnons les entreprises des Pays de la Loire.">
  <section class="max-w-6xl mx-auto px-6 py-24">
    <div class="grid md:grid-cols-2 gap-16">
      <!-- Left: Info -->
      <div class="py-8">
        <p class="section-label mb-6">Contact</p>
        <h1 class="text-4xl md:text-5xl font-bold mb-6">Parlons de votre projet</h1>
        <p class="text-text-secondary text-lg leading-relaxed mb-12">
          Vous avez une idée, un besoin, ou juste une question sur l'IA ?
          Écrivez-nous. On répond vite et on ne mord pas.
        </p>

        <div class="space-y-8">
          <div>
            <p class="section-label mb-2">Email</p>
            <a href="mailto:bonjour@ligerianlabs.fr" class="text-text text-lg hover:text-accent-light transition">
              bonjour@ligerianlabs.fr
            </a>
          </div>
          <div>
            <p class="section-label mb-2">Localisation</p>
            <p class="text-text text-lg">Angers, Pays de la Loire</p>
          </div>
          <div>
            <p class="section-label mb-2">Pour qui ?</p>
            <ul class="text-text-secondary space-y-1">
              <li>PME et TPE des Pays de la Loire</li>
              <li>Artisans et commerçants</li>
              <li>Collectivités et associations</li>
              <li>Startups en phase de croissance</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Right: Form -->
      <div class="bg-surface rounded-2xl p-8 md:p-10">
        <form id="contact-form" class="space-y-5">
          <div>
            <label for="name" class="form-label">Nom *</label>
            <input type="text" id="name" name="name" required class="form-input" placeholder="Votre nom" />
          </div>
          <div>
            <label for="email" class="form-label">Email *</label>
            <input type="email" id="email" name="email" required class="form-input" placeholder="votre@email.fr" />
          </div>
          <div>
            <label for="company" class="form-label">Entreprise</label>
            <input type="text" id="company" name="company" class="form-input" placeholder="Nom de votre entreprise" />
          </div>
          <div>
            <label for="phone" class="form-label">Téléphone</label>
            <input type="tel" id="phone" name="phone" class="form-input" placeholder="06 XX XX XX XX" />
          </div>
          <div>
            <label for="subject" class="form-label">Sujet *</label>
            <select id="subject" name="subject" required class="form-input">
              <option value="" disabled selected>Choisir un sujet</option>
              <option value="conseil">Conseil IA — Audit & stratégie</option>
              <option value="outil">Développement d'un outil IA</option>
              <option value="formation">Formation IA pour mon équipe</option>
              <option value="autre">Autre</option>
            </select>
          </div>
          <div>
            <label for="message" class="form-label">Message *</label>
            <textarea id="message" name="message" rows="5" required class="form-input" placeholder="Décrivez brièvement votre projet ou besoin..."></textarea>
          </div>

          <!-- Honeypot anti-spam -->
          <div class="hidden" aria-hidden="true">
            <input type="text" name="website" tabindex="-1" autocomplete="off" />
          </div>

          <button type="submit" class="w-full bg-accent hover:bg-accent-light text-white px-8 py-3 rounded-lg font-medium transition">
            Envoyer
          </button>
        </form>

        <!-- Success message -->
        <div id="success-message" class="hidden mt-6 bg-green-50 border border-green-200 rounded-lg p-6 text-center">
          <p class="text-green-700 font-medium">✓ Message envoyé !</p>
          <p class="text-text-secondary text-sm mt-2">On revient vers vous rapidement.</p>
        </div>

        <!-- Error message -->
        <div id="error-message" class="hidden mt-6 bg-red-50 border border-red-200 rounded-lg p-6 text-center">
          <p class="text-red-700 font-medium">Erreur lors de l'envoi</p>
          <p class="text-text-secondary text-sm mt-2">Envoyez-nous un email directement à <a href="mailto:bonjour@ligerianlabs.fr" class="text-text underline">bonjour@ligerianlabs.fr</a></p>
        </div>
      </div>
    </div>
  </section>
</Base>

<script>
  const form = document.getElementById("contact-form") as HTMLFormElement;
  const successMsg = document.getElementById("success-message")!;
  const errorMsg = document.getElementById("error-message")!;

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(form);

    // Honeypot check
    if (formData.get("website")) return;

    const data = Object.fromEntries(formData.entries());

    // Track form submission
    if ((window as any).posthog) {
      (window as any).posthog.capture('contact_form_submitted', {
        subject: data.subject,
        has_company: !!data.company,
        has_phone: !!data.phone
      });
    }

    try {
      const res = await fetch("/api/contact", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });

      if (res.ok) {
        form.classList.add("hidden");
        successMsg.classList.remove("hidden");
      } else {
        throw new Error("Failed");
      }
    } catch {
      errorMsg.classList.remove("hidden");
    }
  });
</script>
